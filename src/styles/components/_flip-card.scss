@use '../base/variables' as *;

.flip-card {
  --card-radius: 20px;
  --reveal: 0; /* 0=front, 1=back */
  --frontEdgeColor: rgba(255,255,255,.18); /* color representativo del FRONT */
  --backEdgeColor:  rgba(255,255,255,.35); /* color representativo del BACK  */
  position: relative;
  height: 120px;
  min-height: 120px;
  cursor: pointer;
  outline: none;
  border-radius: var(--card-radius);
  overflow: hidden;
  isolation: isolate;
  
  &:focus-visible {
    outline: 2px solid rgba(255,255,255,.6);
    outline-offset: 3px;
    border-radius: var(--card-radius);
  }

  &.revealed { --reveal: 1; }

  &__inner { 
    position: relative; 
    width: 100%; 
    height: 100%; 
    transform: translateZ(0); 
  }

  &__front,
  &__back {
    position: absolute; 
    inset: 0; 
    border-radius: var(--card-radius);
    transition: opacity .45s ease, transform .6s cubic-bezier(.2,.8,.2,1);
    will-change: opacity, transform;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    color: #fff;
    
    &::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 100px;
      height: 100px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      transform: translate(30px, -30px);
    }
  }

  /* Morph lateral con cross-fade */
  &__front { 
    opacity: calc(1 - var(--reveal)); 
    transform: translateX(calc(-12px * var(--reveal))); 
    z-index: 2; 
  }

  &__back { 
    opacity: var(--reveal); 
    transform: translateX(calc(12px * (1 - var(--reveal)))); 
  }
  
  &__content {
    display: flex;
    align-items: center;
    padding: $spacing-lg;
    height: 100%;
  }
  
  &__icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 60px;
    height: 60px;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.2);
    margin-right: $spacing-md;
    flex-shrink: 0;
    transition: transform 0.3s ease;
    
    span {
      font-size: 24px;
      filter: brightness(1.2);
    }
  }
  
  .stat-content {
    flex: 1;
    
    .stat-value.kpi {
      font-size: 18px;
      font-weight: 700;
      color: $color-white;
      font-family: $font-family;
      line-height: 1.2;
      margin-bottom: $spacing-xs;
    }
    
    .stat-title.subtitle {
      font-size: 14px;
      font-weight: 500;
      color: rgba(255, 255, 255, 0.9);
      font-family: $font-family;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
  }

  /* Cara oculta no recibe eventos → sin flicker */
  &:not(.revealed) .flip-card__back { pointer-events: none; }
  &.revealed .flip-card__front { pointer-events: none; }

  &:hover .flip-card__front,
  &:hover .flip-card__back {
    box-shadow: 0 12px 28px rgba(0,0,0,.22);
    transform: scale(1.02);
  }

  // Efecto de menú al hacer hover
  &:hover {
    transform: translateY(-2px);
    transition: transform 0.2s ease;

    &::before,
    &::after {
      box-shadow: 0 0 12px rgba(255, 255, 255, 0.3);
    }
  }

  // Efecto activo/clickeado
  &:active {
    transform: translateY(0);

    .flip-card__front,
    .flip-card__back {
      box-shadow: 0 6px 16px rgba(0,0,0,.18);
    }
  }

  /* Borde base por cara (6px) usando colores de la cara opuesta */
  /* derecho (visible en FRONT) */
  &::before{
    content:""; position:absolute; top:0; right:0; height:100%; width:6px;
    background: var(--backEdgeColor);
    border-top-right-radius: var(--card-radius); border-bottom-right-radius: var(--card-radius);
    transition: width .5s cubic-bezier(.4,0,.2,1), background .35s ease;
    pointer-events:none; z-index:1;
  }
  /* ocultar derecho cuando está en BACK */
  &.revealed::before{ width:0; }

  /* izquierdo (visible en BACK) */
  &::after{
    content:""; position:absolute; top:0; left:0; height:100%; width:0;
    background: var(--frontEdgeColor);
    border-top-left-radius: var(--card-radius); border-bottom-left-radius: var(--card-radius);
    transition: width .5s cubic-bezier(.4,0,.2,1), background .35s ease;
    pointer-events:none; z-index:1;
  }
  &.revealed::after{ width:6px; }

  /* === Animación del borde SOLO durante el cambio de cara === */
  /* front → back: expandir derecha (der→izq) mientras dura la transición */
  &.edge-anim-right::before{
    width: 100%;
    background: linear-gradient(90deg, var(--backEdgeColor) 0 6px, transparent 6px 100%);
  }
  /* back → front: expandir izquierda (izq→der) mientras dura la transición */
  &.edge-anim-left::after{
    width: 100%;
    background: linear-gradient(270deg, var(--frontEdgeColor) 0 6px, transparent 6px 100%);
  }
}

/* Respeta usuarios con motion reducido */
@media (prefers-reduced-motion: reduce) {
  .flip-card__front, .flip-card__back, .flip-card__inner { 
    transition: none; 
  }
}

// Gradient classes
.-grad-green {
  background: linear-gradient(135deg, #33F491 0%, #1FBF9C 100%);
}

.-grad-green-dark {
  background: linear-gradient(135deg, #1FBF9C 0%, #0D6B57 100%);
}

.-grad-purple {
  background: linear-gradient(135deg, #A66BFF 0%, #7A5CFF 100%);
}

.-grad-purple-dark {
  background: linear-gradient(135deg, #7A5CFF 0%, #5A49D9 100%);
}

.-grad-pink {
  background: linear-gradient(135deg, #FF6A88 0%, #FF3D6E 100%);
}

.-grad-pink-dark {
  background: linear-gradient(135deg, #FF3D6E 0%, #C02F59 100%);
}

.-grad-amber {
  background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
}

.-grad-amber-dark {
  background: linear-gradient(135deg, #D97706 0%, #B45309 100%);
}

// Responsive design
@media (max-width: $breakpoint-md) {
  .flip-card {
    height: 80px;
    min-height: 80px;
    
    &__content {
      padding: $spacing-md;
    }
    
    &__icon {
      width: 50px;
      height: 50px;
      margin-right: 12px;
      
      span {
        font-size: 20px;
      }
    }
    
    .stat-content {
      .stat-value.kpi {
        font-size: 24px;
      }
      
      .stat-title.subtitle {
        font-size: 12px;
      }
    }
  }
}

@media (max-width: 480px) {
  .flip-card {
    height: 70px;
    min-height: 70px;
    
    &__content {
      padding: $spacing-md;
    }
    
    &__icon {
      width: 40px;
      height: 40px;
      margin-right: 10px;
      
      span {
        font-size: 18px;
      }
    }
    
    .stat-content {
      .stat-value.kpi {
        font-size: 20px;
      }
      
      .stat-title.subtitle {
        font-size: 11px;
      }
    }
  }
}