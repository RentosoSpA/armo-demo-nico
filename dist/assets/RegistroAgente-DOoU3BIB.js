import{c as P,F as a,u as A,e as S,f as L,r as o,j as e,g as R,a as y,T as B,B as v,h as F,I as m,U as q,M as U,s as x}from"./index-BmXdxNCh.js";import{v as D,i as H}from"./invitationLinksServiceSupabase-CXDKegVI.js";import{L as b}from"./lock-DxMjBuaL.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],N=P("shield",M),{Title:E,Text:i}=B,W={admin:"Administrador",agent:"Agente",supervisor:"Supervisor",assistant:"Asistente"},$=()=>{const[_]=a.useForm(),[w]=A(),g=S(),{message:l}=L.useApp(),[k,u]=o.useState(!0),[C,c]=o.useState(!1),[r,I]=o.useState(null),[f,p]=o.useState(null),d=w.get("token");o.useEffect(()=>{z()},[d]);const z=async()=>{if(!d){p("Token de invitación no proporcionado"),u(!1);return}u(!0);const s=await D(d);s.success&&s.data?(I(s.data),p(null)):p(s.error||"Token de invitación inválido"),u(!1)},T=async s=>{if(!(!r||!d)){c(!0);try{const{data:n,error:t}=await x.auth.signUp({email:s.email,password:s.password,options:{data:{full_name:s.full_name,empresa_id:r.empresa_id,role:r.role},emailRedirectTo:`${window.location.origin}/`}});if(t){l.error(t.message),c(!1);return}if(!n.user){l.error("Error al crear el usuario"),c(!1);return}const{error:h}=await x.from("user_roles").insert({user_id:n.user.id,empresa_id:r.empresa_id,role:r.role});h&&console.error("Error creating user role:",h);const{error:j}=await x.from("agente").insert({user_uid:n.user.id,empresa_id:r.empresa_id,nombre:s.full_name,email:s.email,telefono:0,codigo_telefonico:56,time_zone:"America/Santiago"});j&&console.error("Error creating agente:",j),await H(r.id),l.success("¡Registro exitoso! Por favor inicia sesión con tus credenciales."),setTimeout(()=>{g("/auth/signin")},2e3)}catch(n){console.error("Error during registration:",n),l.error("Error al completar el registro")}finally{c(!1)}}};return k?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1f2e 0%, #2d3748 100%)"},children:e.jsx(R,{size:"large"})}):f||!r?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1f2e 0%, #2d3748 100%)",padding:"24px"},children:e.jsx(y,{style:{maxWidth:500,width:"100%"},children:e.jsxs("div",{style:{textAlign:"center",padding:"24px 0"},children:[e.jsx(E,{level:3,type:"danger",children:"Error"}),e.jsx(i,{children:f}),e.jsx("div",{style:{marginTop:24},children:e.jsx(v,{type:"primary",onClick:()=>g("/auth/signin"),children:"Ir al Login"})})]})})}):e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1f2e 0%, #2d3748 100%)",padding:"24px"},children:e.jsxs(y,{style:{maxWidth:500,width:"100%"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:32},children:[e.jsx(E,{level:2,children:"Registro de Agente"}),e.jsxs(i,{type:"secondary",style:{color:"#8c8c8c"},children:["Te estás registrando en ",r.empresa.nombre]})]}),e.jsxs("div",{style:{marginBottom:24,padding:16,background:"rgba(51, 244, 145, 0.1)",borderRadius:8,border:"1px solid rgba(51, 244, 145, 0.3)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[e.jsx(F,{size:18,color:"#33F491"}),e.jsx(i,{strong:!0,children:"Empresa: "}),e.jsx(i,{children:r.empresa.nombre})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(N,{size:18,color:"#33F491"}),e.jsx(i,{strong:!0,children:"Rol asignado: "}),e.jsx(i,{children:W[r.role]||r.role})]})]}),e.jsxs(a,{form:_,layout:"vertical",onFinish:T,autoComplete:"off",children:[e.jsx(a.Item,{name:"full_name",label:"Nombre Completo",rules:[{required:!0,message:"Por favor ingresa tu nombre completo"},{min:3,message:"El nombre debe tener al menos 3 caracteres"},{max:100,message:"El nombre no puede exceder 100 caracteres"}],children:e.jsx(m,{prefix:e.jsx(q,{size:18}),placeholder:"Juan Pérez",size:"large"})}),e.jsx(a.Item,{name:"email",label:"Correo Electrónico",rules:[{required:!0,message:"Por favor ingresa tu correo"},{type:"email",message:"Por favor ingresa un correo válido"},{max:255,message:"El correo no puede exceder 255 caracteres"}],children:e.jsx(m,{prefix:e.jsx(U,{size:18}),placeholder:"tu@email.com",size:"large"})}),e.jsx(a.Item,{name:"password",label:"Contraseña",rules:[{required:!0,message:"Por favor ingresa tu contraseña"},{min:6,message:"La contraseña debe tener al menos 6 caracteres"}],children:e.jsx(m.Password,{prefix:e.jsx(b,{size:18}),placeholder:"Contraseña",size:"large"})}),e.jsx(a.Item,{name:"password_confirm",label:"Confirmar Contraseña",dependencies:["password"],rules:[{required:!0,message:"Por favor confirma tu contraseña"},({getFieldValue:s})=>({validator(n,t){return!t||s("password")===t?Promise.resolve():Promise.reject(new Error("Las contraseñas no coinciden"))}})],children:e.jsx(m.Password,{prefix:e.jsx(b,{size:18}),placeholder:"Confirmar contraseña",size:"large"})}),e.jsx(a.Item,{style:{marginBottom:0},children:e.jsx(v,{type:"primary",htmlType:"submit",size:"large",loading:C,block:!0,style:{height:48},children:"Completar Registro"})})]}),e.jsx("div",{style:{marginTop:24,textAlign:"center"},children:e.jsxs(i,{type:"secondary",children:["¿Ya tienes una cuenta?"," ",e.jsx("a",{onClick:()=>g("/auth/signin"),children:"Inicia sesión aquí"})]})})]})})};export{$ as default};
