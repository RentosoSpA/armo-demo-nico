import{s as n}from"./index-BmXdxNCh.js";const l=async(s,r,e)=>{try{const{data:{user:t}}=await n.auth.getUser();if(!t)return{success:!1,error:"No hay usuario autenticado"};const i=`inv_${crypto.randomUUID()}`,{data:o,error:a}=await n.from("invitation_links").insert({empresa_id:s,token:i,role:r,created_by:t.id,max_uses:(e==null?void 0:e.maxUses)||null,expires_at:(e==null?void 0:e.expiresAt)||null}).select().single();return a?(console.error("Error creating invitation link:",a),{success:!1,error:a.message}):{success:!0,link:o}}catch(t){return console.error("Exception creating invitation link:",t),{success:!1,error:t.message}}},u=async s=>{try{const{data:r,error:e}=await n.from("invitation_links").select("*").eq("empresa_id",s).order("created_at",{ascending:!1});return e?(console.error("Error fetching invitation links:",e),[]):r||[]}catch(r){return console.error("Exception fetching invitation links:",r),[]}},g=async(s,r)=>{try{const{error:e}=await n.from("invitation_links").update({role:r}).eq("id",s);return e?(console.error("Error updating invitation link role:",e),{success:!1,error:e.message}):{success:!0}}catch(e){return console.error("Exception updating invitation link role:",e),{success:!1,error:e.message}}},f=async(s,r)=>{try{const{error:e}=await n.from("invitation_links").update({is_active:r}).eq("id",s);return e?(console.error("Error toggling invitation link:",e),{success:!1,error:e.message}):{success:!0}}catch(e){return console.error("Exception toggling invitation link:",e),{success:!1,error:e.message}}},d=async s=>{try{const{error:r}=await n.from("invitation_links").delete().eq("id",s);return r?(console.error("Error deleting invitation link:",r),{success:!1,error:r.message}):{success:!0}}catch(r){return console.error("Exception deleting invitation link:",r),{success:!1,error:r.message}}},m=async s=>{try{const{data:r,error:e}=await n.from("invitation_links").select("*").eq("token",s).eq("is_active",!0).single();if(e||!r)return{success:!1,error:"Link de invitación inválido o inactivo"};if(r.expires_at&&new Date(r.expires_at)<new Date)return{success:!1,error:"El link de invitación ha expirado"};if(r.max_uses!==null&&(r.current_uses||0)>=r.max_uses)return{success:!1,error:"El link de invitación ha alcanzado el máximo de usos"};const{data:t,error:i}=await n.from("empresa").select("*").eq("id",r.empresa_id).single();return i||!t?{success:!1,error:"Empresa no encontrada"}:{success:!0,data:{...r,empresa:t}}}catch(r){return console.error("Error verifying invitation link:",r),{success:!1,error:r.message}}},k=async s=>{try{const{error:r}=await n.rpc("increment_link_usage",{link_id:s});return r?(console.error("Error incrementing link usage:",r),{success:!1,error:r.message}):{success:!0}}catch(r){return console.error("Exception incrementing link usage:",r),{success:!1,error:r.message}}};export{l as c,d,u as g,k as i,f as t,g as u,m as v};
