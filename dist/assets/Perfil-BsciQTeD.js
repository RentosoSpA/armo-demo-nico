import{s as h,f as F,bF as k,b6 as q,F as l,r as N,j as i,a as u,T,g as z,R as p,C as t,I as _,S as P,B as D,bY as $,k as B}from"./index-BmXdxNCh.js";import{D as R}from"./index-B-COQ5gT.js";const V=async e=>{try{const{data:o,error:r}=await h.from("profiles").select("*").eq("user_id",e).single();if(r)throw r;return o}catch(o){throw console.error("Error getting user:",o),o}},G=async(e,o)=>{try{const{data:r,error:n}=await h.from("profiles").update(o).eq("user_id",e).select().single();if(n)throw n;return r}catch(r){throw console.error("Error updating user:",r),r}};function Y(e){return{id:e.id,nombre:e.nombre,email:e.email,telefono:e.telefono.toString(),codigoTelefonico:e.codigo_telefonico,empresaId:e.empresa_id,userUID:e.user_uid,activo:e.activo,createdAt:e.created_at,updatedAt:e.updated_at,lunes_inicio:e.lunes_inicio,lunes_fin:e.lunes_fin,martes_inicio:e.martes_inicio,martes_fin:e.martes_fin,miercoles_inicio:e.miercoles_inicio,miercoles_fin:e.miercoles_fin,jueves_inicio:e.jueves_inicio,jueves_fin:e.jueves_fin,viernes_inicio:e.viernes_inicio,viernes_fin:e.viernes_fin,sabado_inicio:e.sabado_inicio,sabado_fin:e.sabado_fin,domingo_inicio:e.domingo_inicio,domingo_fin:e.domingo_fin}}function H(e){const o={};return e.nombre!==void 0&&(o.nombre=e.nombre),e.email!==void 0&&(o.email=e.email),e.telefono!==void 0&&(o.telefono=parseInt(e.telefono)),e.codigoTelefonico!==void 0&&(o.codigo_telefonico=e.codigoTelefonico),e.activo!==void 0&&(o.activo=e.activo),e.lunes_inicio!==void 0&&(o.lunes_inicio=e.lunes_inicio),e.lunes_fin!==void 0&&(o.lunes_fin=e.lunes_fin),e.martes_inicio!==void 0&&(o.martes_inicio=e.martes_inicio),e.martes_fin!==void 0&&(o.martes_fin=e.martes_fin),e.miercoles_inicio!==void 0&&(o.miercoles_inicio=e.miercoles_inicio),e.miercoles_fin!==void 0&&(o.miercoles_fin=e.miercoles_fin),e.jueves_inicio!==void 0&&(o.jueves_inicio=e.jueves_inicio),e.jueves_fin!==void 0&&(o.jueves_fin=e.jueves_fin),e.viernes_inicio!==void 0&&(o.viernes_inicio=e.viernes_inicio),e.viernes_fin!==void 0&&(o.viernes_fin=e.viernes_fin),e.sabado_inicio!==void 0&&(o.sabado_inicio=e.sabado_inicio),e.sabado_fin!==void 0&&(o.sabado_fin=e.sabado_fin),e.domingo_inicio!==void 0&&(o.domingo_inicio=e.domingo_inicio),e.domingo_fin!==void 0&&(o.domingo_fin=e.domingo_fin),o}const J=async(e,o)=>{try{const r=H(o),{data:n,error:s}=await h.from("agente").update(r).eq("id",e).select().single();if(s)throw s;return Y(n)}catch(r){throw console.error(r),r}},{Title:v,Text:b}=T,K=()=>{const{message:e}=F.useApp(),{loading:o}=k(),{userProfile:r,setUserProfile:n,agent:s,setAgent:A}=q(),[c]=l.useForm(),[j,I]=N.useState(56),C=[{value:56,label:"+56"},{value:54,label:"+54"},{value:57,label:"+57"},{value:1,label:"+1"},{value:52,label:"+52"}];N.useEffect(()=>{console.log("[Profile Component] Profile updated:",r),r&&(console.log("[Profile Component] Setting form values:",r),c.setFieldsValue(r))},[r,c]);const S=async a=>{var x,g;if(r)try{const d={...r,nombre:a.primerNombre,telefono:`+${j}${a.telefono}`},U=$(d);await G(r.uid,U);const f=await V(r.uid),y={uid:r.uid,email:r.email,nombre:((x=f.full_name)==null?void 0:x.split(" ")[0])||"",apellido:((g=f.full_name)==null?void 0:g.split(" ").slice(1).join(" "))||"",telefono:f.phone||""};if(console.log("[Profile] Updated user in store:",y),n(y),s){console.log("[Profile] Current agent:",s),console.log("[Profile] Updating agent with new name:",a.primerNombre);const m={...s,nombre:a.primerNombre};try{await J(s.id,m),A(m),console.log("[Profile] Successfully updated agent in store:",m)}catch(E){console.error("[Profile] Error updating agent:",E)}}else console.log("[Profile] No agent to update");e.success("Perfil actualizado correctamente")}catch(d){console.error("Error updating user:",d),e.error("Error al actualizar el perfil")}};return o?i.jsxs(u,{className:"profile-card w-full",children:[i.jsx(v,{level:3,className:"mb-0",children:"Información del Perfil"}),i.jsx(b,{className:"d-block mt-4 mb-16",children:"Actualiza tu información personal y detalles de contacto."}),i.jsx(z,{className:"d-block"})]}):r?i.jsxs(u,{className:"profile-card w-full",children:[i.jsx(v,{level:2,className:"profile-title",children:"Información del Perfil"}),i.jsx(b,{className:"d-block mt-4 mb-16",children:"Actualiza tu información personal y detalles de contacto."}),i.jsxs(l,{form:c,layout:"vertical",onFinish:S,initialValues:{primerNombre:r.nombre||"",telefono:typeof r.telefono=="string"?r.telefono.replace(/^\+\d+/,""):r.telefono},children:[i.jsxs(p,{gutter:[16,16],children:[i.jsx(t,{span:12,children:i.jsx(l.Item,{label:"Nombre completo",name:"primerNombre",rules:[{required:!0,message:"Por favor ingresa tu nombre"}],children:i.jsx(_,{placeholder:"Ingresa tu nombre completo"})})}),i.jsx(t,{span:12,children:i.jsx(l.Item,{label:"Email",name:"email",children:i.jsx(_,{placeholder:"correo@ejemplo.com",disabled:!0})})})]}),i.jsxs(p,{gutter:[16,16],children:[i.jsx(t,{span:12,children:i.jsx(l.Item,{label:"Teléfono",name:"telefono",rules:[{required:!0,message:"Por favor ingresa tu teléfono"}],children:i.jsx(_,{addonBefore:i.jsx(P,{value:j,onChange:I,options:C}),placeholder:"Número de teléfono"})})}),i.jsx(t,{span:12,children:i.jsx(l.Item,{label:"Tipo de usuario",name:"tipoUsuario",children:i.jsx(P,{placeholder:"Selecciona tipo de usuario",options:[{value:"administrador",label:"Administrador"},{value:"agente",label:"Agente"},{value:"cliente",label:"Cliente"}],disabled:!0})})})]}),i.jsx(R,{}),i.jsx(p,{justify:"end",children:i.jsx(D,{type:"primary",htmlType:"submit",children:"Guardar"})})]})]}):i.jsxs(u,{className:"profile-card w-full",children:[i.jsx(v,{level:3,className:"mb-0",children:"Información del Perfil"}),i.jsx(b,{className:"d-block mt-4 mb-16",type:"danger",children:"No se pudo cargar la información del perfil."})]})},{Title:L,Text:M}=T,W=()=>i.jsxs(B,{direction:"vertical",size:"small",align:"start",className:"w-full",styles:{item:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"}},children:[i.jsxs("div",{className:"mb-24",children:[i.jsx(L,{level:2,className:"title-text text-left mb-0",children:"Perfil"}),i.jsx(M,{className:"paragraph-text paragraph-secondary text-left mb-0",children:"Administra la información de tu cueva"})]}),i.jsx(K,{})]});export{W as default};
