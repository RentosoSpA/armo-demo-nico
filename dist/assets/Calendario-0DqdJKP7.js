import{c as ce,bA as le,bB as de,r as p,d as m,j as e,T as I,S as P,k as L,a9 as me,b8 as ue,bb as k,B as M,bv as pe,J as fe,bz as he,bs as xe,K as ee,a4 as ge,x as G,y as ae,bC as _e,e as ye,F as A,bD as ve,b7 as je,D as be,R as se,b5 as Ce,C as R,a as H,a8 as W,w as Ne,aE as Me}from"./index-BmXdxNCh.js";import{C as Se}from"./chevron-left-DJRchSGG.js";import{a as we}from"./formatters-BB-XqqfA.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Pe=ce("pen",De);var B={exports:{}},Ae=B.exports,U;function Ee(){return U||(U=1,(function(a,s){(function(r,o){a.exports=o(le())})(Ae,(function(r){function o(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var n=o(r),c={name:"es",monthsShort:"ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),weekdays:"domingo_lunes_martes_mi√©rcoles_jueves_viernes_s√°bado".split("_"),weekdaysShort:"dom._lun._mar._mi√©._jue._vie._s√°b.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s√°".split("_"),months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),weekStart:1,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un d√≠a",dd:"%d d√≠as",M:"un mes",MM:"%d meses",y:"un a√±o",yy:"%d a√±os"},ordinal:function(t){return t+"¬∫"}};return n.default.locale(c,null,!0),c}))})(B)),B.exports}Ee();var $={exports:{}},Te=$.exports,Z;function Ye(){return Z||(Z=1,(function(a,s){(function(r,o){a.exports=o()})(Te,(function(){return function(r,o,n){r=r||{};var c=o.prototype,t={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function d(l,u,h,y){return c.fromToBase(l,u,h,y)}n.en.relativeTime=t,c.fromToBase=function(l,u,h,y,N){for(var j,v,C,b=h.$locale().relativeTime||t,S=r.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],E=S.length,D=0;D<E;D+=1){var i=S[D];i.d&&(j=y?n(l).diff(h,i.d,!0):h.diff(l,i.d,!0));var x=(r.rounding||Math.round)(Math.abs(j));if(C=j>0,x<=i.r||!i.r){x<=1&&D>0&&(i=S[D-1]);var g=b[i.l];N&&(x=N(""+x)),v=typeof g=="string"?g.replace("%d",x):g(x,u,i.l,C);break}}if(u)return v;var T=C?b.future:b.past;return typeof T=="function"?T(v):T.replace("%s",v)},c.to=function(l,u){return d(l,u,this,!0)},c.from=function(l,u){return d(l,u,this)};var f=function(l){return l.$u?n.utc():n()};c.toNow=function(l){return this.to(f(this),l)},c.fromNow=function(l){return this.from(f(this),l)}}}))})($)),$.exports}var ke=Ye();const Oe=de(ke);m.extend(Oe);m.locale("es");const{Text:Y}=I,ze=a=>{switch(a){case"scheduling":return"üìÖ";case"confirmed":return"‚úÖ";case"rescheduled":return"üîÑ";case"waiting_response":return"‚è≥";case"cancelled":return"‚ùå";default:return"üìå"}},Ie=a=>{switch(a){case"scheduling":return"Agendando visita";case"confirmed":return"Visita confirmada";case"rescheduled":return"Visita reagendada";case"waiting_response":return"Esperando respuesta";case"cancelled":return"Visita cancelada";default:return"Actividad"}},Fe=a=>{switch(a){case"scheduling":return"#3B82F6";case"confirmed":return"#10B981";case"rescheduled":return"#8B5CF6";case"waiting_response":return"#F59E0B";case"cancelled":return"#EF4444";default:return"#6B7280"}},Le=({activities:a,isTyping:s=!1})=>{const[r,o]=p.useState("today"),[n,c]=p.useState(a);return p.useEffect(()=>{let t=a;const d=m();r==="today"?t=a.filter(f=>m(f.timestamp).isSame(d,"day")):r==="week"&&(t=a.filter(f=>m(f.timestamp).isAfter(d.subtract(7,"day")))),c(t)},[a,r]),e.jsxs("div",{className:"curioso-activity-feed",children:[e.jsxs("div",{className:"curioso-activity-feed__header",children:[e.jsxs("div",{className:"curioso-activity-feed__title",children:[e.jsx("span",{className:"curioso-activity-feed__bear",children:"üêª‚Äç‚ùÑÔ∏è"}),e.jsx(Y,{className:"curioso-activity-feed__title-text",children:"CuriOso en Acci√≥n"})]}),e.jsx("div",{className:"curioso-activity-feed__status",children:e.jsx("span",{className:"curioso-activity-feed__status-dot"})})]}),e.jsx("div",{className:"curioso-activity-feed__filter",children:e.jsx(P,{value:r,onChange:o,size:"small",style:{width:"100%"},options:[{value:"today",label:"Hoy"},{value:"week",label:"Esta semana"},{value:"all",label:"Todas"}]})}),e.jsxs("div",{className:"curioso-activity-feed__timeline",children:[s&&e.jsxs("div",{className:"curioso-activity-feed__typing",children:[e.jsxs("div",{className:"curioso-activity-feed__typing-dots",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]}),e.jsx(Y,{className:"curioso-activity-feed__typing-text",children:"CuriOso est√° procesando..."})]}),n.length===0?e.jsx("div",{className:"curioso-activity-feed__empty",children:e.jsx(Y,{className:"curioso-activity-feed__empty-text",children:"No hay actividad reciente"})}):e.jsx(L,{direction:"vertical",className:"w-full",size:12,children:n.map((t,d)=>e.jsxs("div",{className:"curioso-activity-feed__item",style:{animationDelay:`${d*.1}s`},children:[e.jsx("div",{className:"curioso-activity-feed__item-indicator",style:{backgroundColor:Fe(t.type)},children:e.jsx("span",{className:"curioso-activity-feed__item-icon",children:ze(t.type)})}),e.jsxs("div",{className:"curioso-activity-feed__item-content",children:[e.jsx(Y,{className:"curioso-activity-feed__item-title",children:Ie(t.type)}),e.jsxs(Y,{className:"curioso-activity-feed__item-details",children:[t.prospecto," ‚Üí ",t.propiedad]}),e.jsx(Y,{className:"curioso-activity-feed__item-time",children:m(t.timestamp).fromNow()})]}),t.status==="in_progress"&&e.jsx("div",{className:"curioso-activity-feed__item-badge",children:e.jsx("span",{className:"curioso-activity-feed__item-badge-pulse"})})]},t.id))})]})]})},{Text:F}=I,Ve=a=>({Aprobada:{color:"#10B981",text:"CONFIRMADA"},Completada:{color:"#10B981",text:"COMPLETADA"},Agendada:{color:"#F59E0B",text:"PENDIENTE"},Cancelada:{color:"#EF4444",text:"CANCELADA"}})[a]||{color:"#6B7280",text:a},Be=a=>a.toLowerCase().includes("whatsapp")?"üì±":a.toLowerCase().includes("video")?"üé•":a.toLowerCase().includes("presencial")?"üè¢":"üìç",$e=({visita:a,showActions:s=!0,compact:r=!1,onAction:o})=>{var h;const n=Ve(a.estado),c=a.prospectoInfo,t=((h=c==null?void 0:c.nombre)==null?void 0:h.split(" ").map(y=>y[0]).join("").substring(0,2))||"??",d=m(a.fecha_inicio),f=a.horaFin?m(a.fecha_inicio).hour(typeof a.horaFin=="number"?a.horaFin:parseInt(a.horaFin)):d.add(1,"hour"),l=d.diff(m(),"minute"),u=l>0&&l<180;return e.jsxs("div",{className:`visita-smart-card ${r?"visita-smart-card--compact":""} ${u?"visita-smart-card--upcoming":""}`,children:[e.jsx("div",{className:"visita-smart-card__header",children:e.jsxs("div",{className:"visita-smart-card__avatar-section",children:[e.jsx(me,{size:r?32:40,className:"visita-smart-card__avatar",style:{backgroundColor:"#33F491",color:"#1b2a3a",fontWeight:600},children:t}),e.jsxs("div",{className:"visita-smart-card__header-info",children:[e.jsx(F,{className:"visita-smart-card__prospecto-name",children:(c==null?void 0:c.nombre)||"Prospecto"}),e.jsx(ue,{color:n.color,text:e.jsx("span",{className:"visita-smart-card__status-text",children:n.text})})]})]})}),e.jsxs("div",{className:"visita-smart-card__property",children:[e.jsx("span",{className:"visita-smart-card__icon",children:"üè†"}),e.jsx(F,{className:"visita-smart-card__property-text",children:a.propiedad})]}),e.jsxs("div",{className:"visita-smart-card__time",children:[e.jsx("span",{className:"visita-smart-card__icon",children:"üïê"}),e.jsxs(F,{className:"visita-smart-card__time-text",children:[d.format("HH:mm")," - ",f.format("HH:mm")]}),u&&e.jsxs("span",{className:"visita-smart-card__countdown",children:["(en ",Math.floor(l/60),"h ",l%60,"min)"]})]}),e.jsxs("div",{className:"visita-smart-card__platform",children:[e.jsx("span",{className:"visita-smart-card__icon",children:Be(a.plataforma)}),e.jsx(F,{className:"visita-smart-card__platform-text",children:a.plataforma})]}),a.agendadaPorCurioso&&e.jsxs("div",{className:"visita-smart-card__curioso-badge",children:[e.jsx("span",{className:"visita-smart-card__curioso-icon",children:"üêª‚Äç‚ùÑÔ∏è"}),e.jsx(F,{className:"visita-smart-card__curioso-text",children:"Agendada por CuriOso"})]}),s&&o&&e.jsx("div",{className:"visita-smart-card__actions",children:e.jsxs(L,{size:"small",children:[e.jsx(k,{title:"Contactar por WhatsApp",children:e.jsx(M,{type:"text",size:"small",icon:e.jsx(pe,{size:14}),onClick:()=>o("whatsapp"),className:"visita-smart-card__action-btn"})}),e.jsx(k,{title:"Ver ubicaci√≥n",children:e.jsx(M,{type:"text",size:"small",icon:e.jsx(fe,{size:14}),onClick:()=>o("location"),className:"visita-smart-card__action-btn"})}),e.jsx(k,{title:"Editar",children:e.jsx(M,{type:"text",size:"small",icon:e.jsx(Pe,{size:14}),onClick:()=>o("edit"),className:"visita-smart-card__action-btn"})}),e.jsx(k,{title:"Cancelar",children:e.jsx(M,{type:"text",size:"small",danger:!0,icon:e.jsx(he,{size:14}),onClick:()=>o("cancel"),className:"visita-smart-card__action-btn"})})]})})]})},O=["Juan P√©rez","Mar√≠a L√≥pez","Carlos Ruiz","Ana Garc√≠a","Roberto Silva","Sof√≠a Mart√≠nez","Diego Torres","Carolina Vargas"],X=["Casa en Surco","Depto en Miraflores","Villa en San Miguel","Oficina en San Isidro","Local en La Molina","Casa en Magdalena","Depto en Jes√∫s Mar√≠a","Terreno en Ate"],te=(a=30)=>{const s=[],r=["scheduling","confirmed","rescheduled","waiting_response","cancelled"],o=m("2025-10-01");for(let n=0;n<a;n++){const c=r[Math.floor(Math.random()*r.length)],t=c==="scheduling"?"in_progress":c==="waiting_response"?"pending":"completed",d=Math.floor(n*(45/a)),f=Math.floor(Math.random()*24),l=Math.floor(Math.random()*60);s.push({id:`activity-${n}`,type:c,prospecto:O[Math.floor(Math.random()*O.length)],propiedad:X[Math.floor(Math.random()*X.length)],timestamp:o.add(d,"day").hour(f).minute(l).toISOString(),status:t,metadata:c==="rescheduled"?{previousDate:o.add(d-2,"day").toISOString(),reason:"El prospecto solicit√≥ cambio de horario"}:void 0})}return s.sort((n,c)=>m(c.timestamp).diff(m(n.timestamp)))};let z=null;const Re=async a=>(await new Promise(s=>setTimeout(s,300)),z||(z=te(50)),z),He=async()=>{await new Promise(s=>setTimeout(s,100)),z||(z=te(50));const a=z.filter(s=>m(s.timestamp).isAfter(m().subtract(30,"minute")));return a.some(s=>s.type==="scheduling")?"activo":a.some(s=>s.type==="waiting_response")?"esperando":a.length>0?"analizando":"inactivo"},We=a=>a.map((s,r)=>{const o=Math.random()>.4;return{...s,agendadaPorCurioso:o,estadoCurioso:o?s.estado==="Aprobada"?"confirmada":s.estado==="Agendada"?"esperando_confirmacion":"agendando":void 0,ultimaActividad:o?m().subtract(Math.floor(Math.random()*120),"minute").toISOString():void 0,prospectoInfo:{id:`prospecto-${r}`,nombre:O[r%O.length],telefono:`+51 9${Math.floor(1e7+Math.random()*9e7)}`,email:`${O[r%O.length].toLowerCase().replace(" ",".")}@email.com`},notasCurioso:o?`Prospecto mostr√≥ inter√©s en ${s.propiedad}. Conversaci√≥n positiva v√≠a WhatsApp.`:void 0}}),oe=async a=>{await new Promise(t=>setTimeout(t,100));const s=m(),r=a.filter(t=>m(t.fecha_inicio).isSame(s,"day")),o=a.filter(t=>m(t.fecha_inicio).isAfter(s.startOf("week"))&&m(t.fecha_inicio).isBefore(s.endOf("week"))),n=a.filter(t=>t.agendadaPorCurioso).length,c=a.filter(t=>t.agendadaPorCurioso&&(t.estado==="Aprobada"||t.estado==="Completada")).length;return{visitasAgendadasHoy:r.length,visitasEstaSemana:o.length,porcentajeAgendadasPorCurioso:a.length>0?Math.round(n/a.length*100):0,tasaConfirmacion:n>0?Math.round(c/n*100):0}};m.locale("es");const{Text:q}=I,qe=({selectedDate:a,visitas:s,onAddVisita:r})=>{const[o,n]=p.useState([]),[c,t]=p.useState(null),[d,f]=p.useState(!0),l=s.filter(u=>m(u.fecha_inicio).format("YYYY-MM-DD")===a);return p.useEffect(()=>{(async()=>{try{const[h,y]=await Promise.all([Re(),oe(s)]);n(h),t(y)}catch(h){console.error("Error loading CuriOso data:",h)}finally{f(!1)}})()},[s]),e.jsxs("div",{className:"leftPanel",children:[e.jsx("div",{className:"mb-16",children:e.jsx(Le,{activities:o,isTyping:d})}),c&&e.jsxs("div",{className:"mb-16",style:{background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.08)",borderRadius:"12px",padding:"12px"},children:[e.jsxs(q,{style:{fontSize:"13px",color:"#9ca3af"},children:["üìä Visitas esta semana: ",e.jsx("strong",{style:{color:"#33F491"},children:c.visitasEstaSemana})]}),e.jsx("br",{}),e.jsxs(q,{style:{fontSize:"13px",color:"#9ca3af"},children:["üêª‚Äç‚ùÑÔ∏è Por CuriOso: ",e.jsxs("strong",{style:{color:"#33F491"},children:[c.porcentajeAgendadasPorCurioso,"%"]})]})]}),e.jsxs("div",{className:"visitasPanel mb-16",children:[e.jsxs("div",{className:"d-flex align-center justify-between mb-16",children:[e.jsx(q,{className:"font-semibold",children:"Visitas programadas"}),e.jsx(M,{type:"text",icon:e.jsx(xe,{size:16}),onClick:r,style:{padding:"4px 8px",height:"auto",color:"#33F491"}})]}),e.jsx("div",{className:"pr-4",children:l.length===0?e.jsx("div",{className:"text-center p-24",children:"No hay visitas programadas para este d√≠a"}):e.jsx(L,{direction:"vertical",className:"w-full",size:"middle",children:l.map(u=>e.jsx($e,{visita:u,compact:!0,showActions:!1},u.id))})})]})]})},Ke=({date:a,visitas:s,isSelected:r,isCurrentMonth:o,hasRecentActivity:n=!1,onSelect:c})=>{const t=a.format("YYYY-MM-DD"),d=s.filter(v=>m(v.fecha_inicio).format("YYYY-MM-DD")===t),f=d.length>0,l=a.isSame(m(),"day"),u=d.filter(v=>v.estado==="Aprobada"||v.estado==="Completada").length,h=d.filter(v=>v.estado==="Agendada").length,y=d.filter(v=>v.agendadaPorCurioso).length,N=()=>d.length===0?null:e.jsxs("div",{className:"intelligent-calendar-day__tooltip",children:[e.jsx("div",{className:"intelligent-calendar-day__tooltip-header",children:a.format("DD MMMM YYYY")}),e.jsxs("div",{className:"intelligent-calendar-day__tooltip-stats",children:[u>0&&e.jsxs("div",{className:"intelligent-calendar-day__tooltip-stat",children:[e.jsx("span",{className:"dot dot--confirmed"}),u," Confirmada",u>1?"s":""]}),h>0&&e.jsxs("div",{className:"intelligent-calendar-day__tooltip-stat",children:[e.jsx("span",{className:"dot dot--pending"}),h," Pendiente",h>1?"s":""]}),y>0&&e.jsxs("div",{className:"intelligent-calendar-day__tooltip-stat",children:[e.jsx("span",{className:"dot dot--curioso"}),y," por CuriOso üêª‚Äç‚ùÑÔ∏è"]})]})]}),j=e.jsxs("div",{className:`intelligent-calendar-day ${r?"intelligent-calendar-day--selected":""} 
                 ${o?"":"intelligent-calendar-day--other-month"} 
                 ${f?"intelligent-calendar-day--has-visits":""}
                 ${n?"intelligent-calendar-day--recent-activity":""}
                 ${l?"intelligent-calendar-day--today":""}`,onClick:()=>o&&c(a),children:[e.jsx("div",{className:"intelligent-calendar-day__number",children:a.date()}),f&&e.jsxs("div",{className:"intelligent-calendar-day__indicators",children:[u>0&&e.jsx("span",{className:"intelligent-calendar-day__dot intelligent-calendar-day__dot--confirmed"}),h>0&&e.jsx("span",{className:"intelligent-calendar-day__dot intelligent-calendar-day__dot--pending"}),y>0&&e.jsx("span",{className:"intelligent-calendar-day__dot intelligent-calendar-day__dot--curioso"})]}),d.length>1&&e.jsx("div",{className:"intelligent-calendar-day__count",children:d.length})]});return f?e.jsx(k,{title:N(),placement:"top",mouseEnterDelay:.3,children:j}):j};m.locale("es");const Ge=({selectedDate:a,onSelectDate:s,visitas:r})=>{const[o,n]=p.useState(m(a)),c=()=>{n(o.subtract(1,"month"))},t=()=>{n(o.add(1,"month"))},d=l=>{s(l.format("YYYY-MM-DD"))},f=()=>{const l=o.startOf("month"),u=o.endOf("month"),h=l.startOf("week"),y=u.endOf("week"),N=[];let j=h;["S","M","T","W","T","F","S"].forEach((b,S)=>{N.push(e.jsx("div",{className:"text-center font-semibold",style:{gridRow:1,gridColumn:S+1,display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",color:"#ffffff",borderRadius:"4px",fontSize:"14px",fontWeight:600},children:b},`weekday-${S}`))});let C=0;for(;j.isBefore(y)||j.isSame(y);){const b=j,S=b.isSame(o,"month"),E=b.format("YYYY-MM-DD")===a,D=r.some(i=>{const x=m(i.fecha_inicio).format("YYYY-MM-DD"),g=i.ultimaActividad?m(i.ultimaActividad):null;return x===b.format("YYYY-MM-DD")&&g&&g.isAfter(m().subtract(2,"hour"))});N.push(e.jsx("div",{className:"day",style:{gridRow:Math.floor(C/7)+2,gridColumn:C%7+1},children:e.jsx(Ke,{date:b,visitas:r,isSelected:E,isCurrentMonth:S,hasRecentActivity:D,onSelect:d})},b.format("YYYY-MM-DD"))),j=j.add(1,"day"),C++}return N};return e.jsxs("div",{className:"calendar-wrapper w-full p-16",children:[e.jsxs("div",{className:"calendar-header",children:[e.jsx(M,{type:"text",icon:e.jsx(Se,{size:16}),onClick:c,style:{color:"#ffffff",backgroundColor:"transparent",border:"none",borderRadius:"8px"}}),e.jsxs("div",{className:"d-flex align-center font-semibold gap-8",children:[e.jsx(ee,{size:20}),o.format("MMMM YYYY")]}),e.jsx(M,{type:"text",icon:e.jsx(ge,{size:16}),onClick:t,style:{color:"#ffffff",backgroundColor:"transparent",border:"none",borderRadius:"8px"}})]}),e.jsx("div",{className:"calendar-grid",children:f()})]})},Je=({selectedDate:a,onSelectDate:s,visitas:r})=>e.jsx("div",{className:"calendarCard",children:e.jsx("div",{className:"calendarInner",children:e.jsx("div",{className:"cal-card__body",children:e.jsx(Ge,{selectedDate:a,onSelectDate:s,visitas:r})})})}),re=[...ae.visitas],Ue=async()=>(await G(),re),Ze=async a=>{await G();const s={...a,id:_e()};return re.push(s),s},V=({error:a})=>a?e.jsx("span",{className:"d-block mt-4",children:a}):null,{Option:Q}=P,Xe=({visible:a,prospectos:s=[],selectedDate:r,onCancel:o,onReload:n})=>{const c=ye(),[t]=A.useForm(),[d,f]=p.useState(!1),[l,u]=p.useState(!1),[h,y]=p.useState(null),[N,j]=p.useState([]),[v,C]=p.useState({}),b=()=>{const i=t.getFieldsValue(),x={};return i.propiedadId||(x.propiedadId="Por favor selecciona una propiedad"),i.prospectoId||(x.prospectoId="Por favor selecciona un prospecto"),i.estado||(x.estado="Por favor selecciona un estado"),i.fecha||(x.fecha="Por favor selecciona una fecha"),x},S=async()=>{var i,x,g,T,J;try{f(!0),C({}),y(null);const _=b();if(Object.keys(_).length>0){C(_),f(!1);return}const w=t.getFieldsValue(),ie={propiedad:((i=N.find(ne=>ne.id===w.propiedadId))==null?void 0:i.titulo)||"Propiedad no encontrada",fecha_inicio:w.fecha.toISOString(),estado:w.estado||"Agendada",plataforma:"Manual",prospectoId:w.prospectoId};await Ze(ie),t.resetFields(),C({}),o(),n()}catch(_){console.error("Error al crear visita:",_);let w="Error desconocido al crear la visita";typeof _=="object"&&_!==null&&"message"in _&&typeof _.message=="string"?w=_.message:typeof _=="object"&&_!==null&&"response"in _&&((g=(x=_.response)==null?void 0:x.data)!=null&&g.message)?w=_.response.data.message:typeof _=="object"&&_!==null&&"response"in _&&((J=(T=_.response)==null?void 0:T.data)!=null&&J.error)?w=_.response.data.error:typeof _=="string"&&(w=_),y(w)}finally{f(!1)}},E=()=>{t.resetFields(),C({}),y(null),o()};p.useEffect(()=>{if(a){y(null),D(),t.resetFields();const i=m(),x=m(r),g=x.isBefore(i,"day")?i:x;t.setFieldsValue({estado:"Agendada",fecha:g})}},[a,t,r]),p.useEffect(()=>{if(a){const i=setTimeout(()=>{document.querySelectorAll('.nueva-visita-modal .ant-form-item-explain-error, .nueva-visita-modal .ant-form-item-explain, .nueva-visita-modal [class*="explain"]').forEach(g=>{g instanceof HTMLElement&&(g.style.setProperty("background-color","transparent","important"),g.style.setProperty("background","transparent","important"),g.style.setProperty("background-image","none","important"))})},100);return()=>clearTimeout(i)}},[a]),p.useEffect(()=>{const i=setTimeout(()=>{document.querySelectorAll('.nueva-visita-modal .ant-form-item-explain-error, .nueva-visita-modal .ant-form-item-explain, .nueva-visita-modal [class*="explain"]').forEach(g=>{g instanceof HTMLElement&&(g.style.setProperty("background-color","transparent","important"),g.style.setProperty("background","transparent","important"),g.style.setProperty("background-image","none","important"))})},50);return()=>clearTimeout(i)});async function D(){try{u(!0);const i=await ve();j(i)}catch{y("Error al cargar los datos")}finally{u(!1)}}return e.jsxs(je,{title:"Nueva Visita",open:a,onCancel:E,footer:null,width:500,className:"nueva-visita-modal",children:[h&&e.jsx("div",{className:"p-12 mb-16",children:h}),s&&s.length===0&&e.jsxs("div",{className:"text-center mb-16 p-20",children:[e.jsx("p",{style:{margin:"0 0 12px 0",color:"#656d76"},children:"No hay prospectos disponibles"}),e.jsx(M,{type:"primary",onClick:()=>{E(),c("/prospectos")},children:"A√±adir prospectos"})]}),e.jsxs(A,{form:t,layout:"vertical",style:{marginTop:h?0:16},children:[e.jsx(A.Item,{name:"prospectoId",label:"Prospecto",children:e.jsx(P,{placeholder:"Selecciona un prospecto",showSearch:!0,optionFilterProp:"children",disabled:!s||s.length===0,children:s&&s.map(i=>e.jsx(Q,{value:i.id,children:i.primer_nombre&&i.primer_apellido?`${i.primer_nombre} ${i.primer_apellido}`:i.email||i.display_name||`ID: ${i.id}`},i.id))})}),e.jsx(V,{error:v.prospectoId}),e.jsx(A.Item,{name:"propiedadId",label:"Propiedad",children:e.jsx(P,{placeholder:"Selecciona una propiedad",showSearch:!0,optionFilterProp:"children",loading:l,children:N.map(i=>e.jsx(Q,{value:i.id||"",children:i.titulo},i.id))})}),e.jsx(V,{error:v.propiedadId}),e.jsx(A.Item,{name:"estado",label:"Estado",children:e.jsxs(P,{placeholder:"Selecciona el estado",children:[e.jsx(P.Option,{value:"Agendada",children:"Agendada"}),e.jsx(P.Option,{value:"Aprobada",children:"Aprobada"}),e.jsx(P.Option,{value:"Completada",children:"Completada"}),e.jsx(P.Option,{value:"Cancelada",children:"Cancelada"})]})}),e.jsx(V,{error:v.estado}),e.jsx(A.Item,{name:"fecha",label:"Fecha",children:e.jsx(be,{format:"DD/MM/YYYY",placeholder:"Selecciona fecha",className:"w-full",disabledDate:i=>i&&i.isBefore(m())})}),e.jsx(V,{error:v.fecha}),e.jsx(A.Item,{className:"text-right mb-0",children:e.jsxs(L,{children:[e.jsx(M,{type:"default",disabled:!0,"aria-disabled":"true",title:"Pr√≥ximamente",children:"A√±adir orden de visita"}),e.jsx(M,{type:"primary",onClick:S,loading:d,children:"Crear Visita"})]})})]})]})},Qe=a=>({activo:{color:"#10B981",label:"Activo",icon:"üü¢",tooltip:"CuriOso est√° agendando visitas activamente",isPulsing:!0},esperando:{color:"#F59E0B",label:"Esperando",icon:"üü°",tooltip:"CuriOso est√° esperando respuestas de prospectos",isPulsing:!1},analizando:{color:"#3B82F6",label:"Analizando",icon:"üîµ",tooltip:"CuriOso est√° procesando informaci√≥n",isPulsing:!0},inactivo:{color:"#6B7280",label:"Inactivo",icon:"‚ö™",tooltip:"CuriOso no tiene actividad reciente",isPulsing:!1}})[a],ea=({status:a,showLabel:s=!0,size:r="medium"})=>{const o=Qe(a),n=e.jsxs("div",{className:`curioso-status-badge curioso-status-badge--${r} ${o.isPulsing?"curioso-status-badge--pulsing":""}`,children:[e.jsx("span",{className:"curioso-status-badge__bear",role:"img","aria-label":"CuriOso",children:"üêª‚Äç‚ùÑÔ∏è"}),e.jsx("span",{className:"curioso-status-badge__dot",style:{backgroundColor:o.color},children:o.isPulsing&&e.jsx("span",{className:"curioso-status-badge__pulse",style:{borderColor:o.color}})}),s&&e.jsx("span",{className:"curioso-status-badge__label",children:o.label})]});return e.jsx(k,{title:o.tooltip,placement:"bottom",children:n})},{Title:aa,Text:ua}=I,sa=({onAddVisita:a})=>{const[s,r]=p.useState("activo");return p.useEffect(()=>{(async()=>{const n=await He();r(n)})()},[]),e.jsxs(se,{justify:"space-between",align:"middle",className:"mb-24",children:[e.jsxs("div",{children:[e.jsxs(L,{align:"center",size:"middle",children:[e.jsx(aa,{level:2,className:"title-text mb-0",children:"Visitas"}),e.jsx(ea,{status:s})]}),e.jsx("div",{className:"paragraph-text paragraph-secondary mb-8",children:"Gestiona las visitas agendadas. CuriOso est√° trabajando para ti."})]}),e.jsx("div",{className:"d-flex align-center gap-12",children:e.jsx(M,{type:"primary",icon:e.jsx(Ce,{}),onClick:a,children:"Agregar Visita"})})]})},{Title:pa}=I,{Text:K}=I,ta=({visitas:a})=>{const[s,r]=p.useState(null),[o,n]=p.useState(!0);return p.useEffect(()=>{(async()=>{try{const t=await oe(a);r(t)}catch(t){console.error("Error loading stats:",t)}finally{n(!1)}})()},[a]),s?e.jsxs(se,{gutter:[16,16],style:{marginBottom:"16px",marginTop:"-8px"},children:[e.jsx(R,{xs:12,sm:8,md:8,children:e.jsx(H,{className:"glass",bordered:!1,size:"small",style:{background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.08)"},children:e.jsx(W,{title:e.jsx(K,{style:{color:"#9ca3af",fontSize:"12px"},children:"Visitas Hoy"}),value:s.visitasAgendadasHoy,prefix:e.jsx(ee,{size:16,style:{color:"#33F491"}}),valueStyle:{color:"#ffffff",fontSize:"20px",fontWeight:600},loading:o})})}),e.jsx(R,{xs:12,sm:8,md:8,children:e.jsx(H,{className:"glass",bordered:!1,size:"small",style:{background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)"},children:e.jsx(W,{title:e.jsx(K,{style:{color:"#93c5fd",fontSize:"12px"},children:"üêª‚Äç‚ùÑÔ∏è Por CuriOso"}),value:s.porcentajeAgendadasPorCurioso,suffix:"%",valueStyle:{color:"#ffffff",fontSize:"20px",fontWeight:600},loading:o})})}),e.jsx(R,{xs:12,sm:8,md:8,children:e.jsx(H,{className:"glass",bordered:!1,size:"small",style:{background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)"},children:e.jsx(W,{title:e.jsx(K,{style:{color:"#6ee7b7",fontSize:"12px"},children:"Tasa Confirmaci√≥n"}),value:s.tasaConfirmacion,suffix:"%",prefix:e.jsx(Ne,{size:16,style:{color:"#10B981"}}),valueStyle:{color:"#ffffff",fontSize:"20px",fontWeight:600},loading:o})})})]}):null},oa=[{id:"tour-001",espacio_id:"esp-001",espacio_nombre:"Oficina Privada 201",prospecto_id:"prosp-001",prospecto_info:{id:"prosp-001",nombre:"Mar√≠a Gonz√°lez",telefono:"+56912345678",email:"maria.gonzalez@gmail.com"},fecha_inicio:new Date(Date.now()+2880*60*1e3).toISOString(),hora_inicio:"10:00",hora_fin:"10:45",estado:"Confirmado",tipo:"Presencial",interes_en:"Hot Desk",notas:"Interesada en plan mensual"},{id:"tour-002",espacio_id:"esp-002",espacio_nombre:"Sala Laurel",prospecto_id:"prosp-002",prospecto_info:{id:"prosp-002",nombre:"Carlos Mu√±oz",telefono:"+56987654321",email:"carlos.munoz@empresa.cl"},fecha_inicio:new Date(Date.now()+1440*60*1e3).toISOString(),hora_inicio:"14:00",hora_fin:"15:00",estado:"Agendado",tipo:"Presencial",interes_en:"Oficina Privada",notas:"Tour programado para ma√±ana"},{id:"tour-003",espacio_id:"esp-003",espacio_nombre:"Hot Desk - Zona Norte",prospecto_id:"prosp-003",prospecto_info:{id:"prosp-003",nombre:"Ana Torres",telefono:"+56911223344",email:"ana.torres@freelance.com"},fecha_inicio:new Date(Date.now()-4320*60*1e3).toISOString(),hora_inicio:"11:00",hora_fin:"11:30",estado:"Completado",tipo:"Virtual",plataforma:"Zoom",interes_en:"Escritorio Flexible"}],ra=a=>{var s,r,o;return{id:a.id,prospecto_id:a.prospecto_id||"",propiedad_id:a.espacio_id||"",propiedad:null,prospecto:null,agente_id:"agente-cristobal",fecha_inicio:a.fecha_inicio,fecha_fin:a.fecha_fin,estado:a.estado,plataforma:a.plataforma,observaciones:a.notas,propiedad_titulo:a.espacio_nombre,prospecto_nombre:(s=a.prospecto_info)==null?void 0:s.nombre,prospecto_telefono:(r=a.prospecto_info)==null?void 0:r.telefono,prospecto_email:(o=a.prospecto_info)==null?void 0:o.email}},ia=async()=>{const{activePreset:a}=Me.getState();return a==="coworking"?(await new Promise(s=>setTimeout(s,400)),oa.map(ra)):Ue()},na=[...ae.prospectos],ca=async()=>(await G(),na),fa=()=>{const[a,s]=p.useState([]),[r,o]=p.useState([]),[n,c]=p.useState(new Date().toISOString().slice(0,10)),[t,d]=p.useState(!1);p.useEffect(()=>{f()},[]);const f=async()=>{try{const[l,u]=await Promise.all([ia(),ca()]),h=We(l);s(h),o(u)}catch(l){console.error("Error fetching data:",l)}};return e.jsxs("div",{style:{padding:"0 16px 24px 16px"},children:[e.jsx(sa,{onAddVisita:()=>d(!0)}),e.jsx(ta,{visitas:a}),e.jsxs("div",{className:"calendarLayout",children:[e.jsxs("div",{className:"calendarSubheader",children:[e.jsx("div",{className:"calendarDate",children:we(n)}),e.jsxs("div",{className:"calendarLegend",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"dot",style:{background:"#10B981",boxShadow:"0 0 6px rgba(16, 185, 129, 0.6)"}}),e.jsx("span",{children:"Confirmada"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"dot",style:{background:"#F59E0B",boxShadow:"0 0 6px rgba(245, 158, 11, 0.6)"}}),e.jsx("span",{children:"Pendiente"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"dot",style:{background:"#3B82F6",boxShadow:"0 0 6px rgba(59, 130, 246, 0.6)"}}),e.jsx("span",{children:"CuriOso Agendando"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"dot",style:{background:"#EF4444"}}),e.jsx("span",{children:"Cancelada"})]})]})]}),e.jsx(qe,{selectedDate:n,visitas:a,onAddVisita:()=>d(!0)}),e.jsx(Je,{selectedDate:n,onSelectDate:c,visitas:a})]}),e.jsx(Xe,{visible:t,prospectos:r,selectedDate:n,onCancel:()=>d(!1),onReload:f})]})};export{fa as default};
